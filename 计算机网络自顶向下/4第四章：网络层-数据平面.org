* 网络层概述
我们将看到网络层能够被 分解为两个相互作用的部分，即 *数据平面和控制平面*  *数据平面功能* ，
=即网络层中每台路由器的功能，该数据平面功能决定到达路由器输入链 路之一的数据报（即网络层的分组）如何转发到该路由器的输出链路之一=
就是数据如何到达并且转发到其中某个输出链路的

数据平面和控制平面是一个路由器的两个功能的描述，路由器有一个 *route table 叫做路由表* 和一个 *forwarding table转发表* route table
是控制平面的功能得到的， forwarding table是根据路由表获取然后控制转发功能；

[[file:imag/Snipaste_2024-01-02_20-22-29.png]]

上图是网络连接的基本情况，从端系统H1到另一个端系统H2；通过本地路由器进行，接入本地ISP然后到达另一个字网系统最后到达端服务器
路由器中间的链路是不需应用层和运输层的，三层结构就行了；
路由器分两部分，一部分是数据转发，由转发表控制，一部分是数据控制，由路由表控制；

** 4.1.1 转发和路由选择：数据平面和控制平面

这两个是网络层的一体两面，一个负责路由器之间的控制，另一个只控制数据转发到相应的端口，是硬件方面的功能；

+ =转发= 一个分组到达路由器的一个输入链路到达时，该路由器必须将该分组转移到适当的输出链路。
+ =路由选择= 。当分组从发送方流向接收方时，网络层必须决定这些分组所采用的路 由或路径。
  计算这些路径的算法被称为路由选择算法(routing algorithm)

  [[file:imag/Snipaste_2024-01-02_20-35-42.png]]

  上述图片是一个路由器中的结构，其中路由转发表是由路由选择算法得到的；

  1. 控制平面传统方法
     #+begin_quote
     路由选择和转发间的重要相互作用关系。如图4・2所示，路由选择算法决定了插入该 路由器转发表的内容。
     在这个例子中，路由选择算法运行在每台路由器中，并且在每台路由器中都包含转发和路由选择两种功能
     #+end_quote
     传统情况下是每台路由器上面都有 *路由选择算法* 该算法决定哪些只放入路由转发表中；

  2. 控制平面：SDN方法
     [[file:imag/Snipaste_2024-01-02_20-42-13.png]]

     路由器与SDN网络服务器组件进行通信，组件控制可以随时改变，灵活方便；决定转发表应该如何行动 ；
     软件定义网络（Soft-ware-Defined Networking, SDN）


** 4.2 路由器工作原理

[[file:imag/Snipaste_2024-01-02_20-47-41.png]]

上图是路由器体系的基本结构，从输入端口经交换结构到达转发，前面每层都对数据进行拆封，到达3端口，网络层；

+ =输入端口=
  [[file:imag/Snipaste_2024-01-02_20-53-50.png]]
  经过物理层，链路层到达网络层，会进行转发排队，最终到达交换结构
+ =交换结构=
  可以实现交换功能，从输入端口到特定的输出端口，一般有以下三种实现方式
  1) 内存交换
     [[file:imag/Snipaste_2024-01-02_20-57-24.png]]
     #+begin_quote
     在输入端口和输出端口之间是通过 CPU 进行的。输入端口和输出端口的功能就好像传统操作系统中的 I/O 设备一样。当一个分组到达输入端口时，
     这个端口会首先以中断 的方式向路由选择器发出信号，将分组从输入端口拷贝到内存中。
     然后，路由选择处理器从分组首部中提取目标地址，在转发表中找出适当的输出端口进行转发，同时将分组复制到输出端口的缓存中
     #+end_quote
     就是CPU控制了一次I/O，把分组数据从一个输入端口经过内存复制，缓存到输出端口的网络层中
  2) 总线交换
     [[file:imag/Snipaste_2024-01-02_21-01-18.png]]
     #+begin_quote
     ，总线经由输入端口直接将分组传送到输出端口，中间不需要路由选择器的干预。总线的工作流程如下：输入端口给分组分配一个标签，
     然后分组经由总线发送给所有的输出端口，每个输出端口都会判断标签中的端口和自己的是否匹配，如果匹配的话，
     那么这个输出端口就会把标签拆掉，这个标签只用于交换机内部跨越总线。如果同时有 多个 分组到达路由器的话，
     那么只有一个分组能够被处理，其他分组需要再进入交换结构前等待。
     #+end_quote
     不需要处理器参与，内部总线结构完成相应的交换
  3) 网络互联交换
     [[file:imag/Snipaste_2024-01-02_21-03-56.png]]
     非阻塞的交换，可以同时进行多个端口交换，前提是输出端口不同
+ =输出端口=
  [[file:imag/Snipaste_2024-01-02_21-07-18.png]]
+ =路由选择处理器=
  #+begin_quote
  路由选择处理器执行控制平面功能。在传统的路由器中，它执行 路由选择协议
  维护路由选择表与关联链路状态信息，并为该路由器计算转发表。在SDN路由器中，路由选择处理器（在其他活 动中）负责与远程控制器通信，
  目的是接收由远程控制器计算的转发表项，并在该 路由器的输入端口安装这些表项。路由选择处理器还执行网络管理功能
  #+end_quote


** 4.3 IPv4,IPv6,寻址

*** IPv4协议

*** 编址方式

ip地址采用十分制，点分制标识IP地址；192.168.1.1；采用点分割，每个点之间是8bit的十进制数字，一共是32bit
每个区间的数字范围是0-255；

1. =标准分类方式，ABC=
   #+begin_quote
    1. 类别A：
	类别A地址使用了最高位为0的地址范围，即第一个比特位为0，它的网络标识位为1位，主机标识位为31位。
	范围：0.0.0.0 到 127.255.255.255
	第一个字节的最高位始终为0，表示这是类别A地址。
	这个类别的地址范围非常广泛，能够支持数量庞大的主机，但网络数量相对较少。

    2. 类别B：
	类别B地址的最高位为10，网络标识位为2位，主机标识位为16位。
	范围：128.0.0.0 到 191.255.255.255
	类别B地址既可以支持大量的网络数量，也能够支持每个网络上的较多主机数量。

    3. 类别C：
	类别C地址的最高位为110，网络标识位为3位，主机标识位为8位。
	范围：192.0.0.0 到 223.255.255.255
	类别C地址适用于较多的网络数量，但每个网络上的主机数量相对较少。

    4. 类别D：
	类别D地址范围为224.0.0.0 到 239.255.255.255，其最高位以1110开始。
	这个范围用于多播（Multicast）地址，用于将数据包发送到多个主机，但不是全部主机的情况。

    5. 类别E：
	类别E地址范围为240.0.0.0 到 255.255.255.255，最高位以1111开始。
	这个范围被保留，用于实验和将来可能的特殊用途，不用于一般的通信。
    #+end_quote
   | 分类 | 开头标识 | 范围                         | 私有地址范围                   |
   |-----+--------+-----------------------------+------------------------------|
   | A类  |      0 | 0.0.0.0   到 127.255.255.255 | 10.0.0.0 到 10.255.255.255    |
   | B类  |     10 | 128.0.0.0 到 191.255.255.255 | 172.16.0.0 到 172.31.255.255  |
   | C类  |    110 | 192.0.0.0 到 223.255.255.255 | 192.168.0.0 到 192.168.255.255 |
   | D类  |   1110 | 224.0.0.0 到 239.255.255.255 |         无                    |
   | E类  |  11110 | 240.0.0.0 到 255.255.255.255 |          无                   |
   
   [[file:imag/Snipaste_2024-01-07_23-19-45.png]]

2. =CIDR（无类别域间路由）=
   这种分类方式更加灵活，标识方式为192.168.1.0/24，表示该网络的前24位用于网络标识，剩余的8位用于主机标识；
   后面的24代表网络号占位，余下的就是主机号，如果你还想进行字网划分，就可以继续借用主机号进行标识字网号；

   #+begin_example
   假如现在有一个申请的网段：192.168.1.0/24； 那么余下的8为就是主机号，如果想要划分为四个字网，2^2=4；
   因此需要借用2位主机号；那么还剩余6位作为主机号；四个字网号分别是00，10，01，11；划分如下
   | 字网号 | 网络号范围                      |
   |-------+-------------------------------|
   |    00 | 192.168.1.0 到 192.168.1.63    |
   |    01 | 192.168.1.64 到 192.168.1.127  |
   |    10 | 192.168.1.128 到 192.168.1.191 |
   |    11 | 192.168.1.192 到 192.168.1.255 | 

   划分是这样，每个网段是有64个主机可供配置，但是一般起始网段ip作为网关号或者路由器ip，最后一位作为广播地址，
   实际上每个网段可用的ip有62个；
   #+end_example

3. =子网掩码=
   

  
   

   
   

  
























