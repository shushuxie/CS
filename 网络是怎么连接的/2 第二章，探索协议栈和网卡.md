<img src="imag/Snipaste_2023-09-13_23-54-53.png" alt="Snipaste_2023-09-13_23-54-53" style="zoom:50%;" />

### （1）创建套接字 

从应用程序收到委托后，协议栈通过 TCP 协议收发数据的操作可 以分为 4 个阶段。首先是创建套接字，在这个阶段，我们将介绍协议 栈的内部结构、套接字的实体，以及创建套接字的操作过程。到这 里，大家应该可以对套接字到底是什么样的一个东西有一个比较具体 的理解。

### （2）连接服务器 

接下来是客户端套接字向服务器套接字进行连接的阶段。我们将介绍 “连接”具体是进行怎样的操作，在这个过程中协议栈到底是如何工作的， 以及客户端和服务器是如何进行交互的。 

### （3）收发数据 

两端的套接字完成连接之后，就进入收发消息的阶段了。在这个阶段， 协议栈会将从应用程序收到的数据切成小块并发送给服务器，考虑到通信 过程中可能会出错导致网络包丢失，协议栈还需要确认切分出的每个包是 否已经送达服务器，对于没有送达的包要重新发送一次。这里我们将对收 发数据的情形加以说明。 

### （4）从服务器断开连接并删除套接字

 收发消息的操作全部结束之后，接下来要断开服务器的连接并删除套 接字。断开操作的本质是当消息收发完成后客户端和服务器相互进行确认 的过程，但这个过程并不只是相互确认并删除套接字那么简单，其中有些 地方是很有意思的。

###  （5）IP 与以太网的包收发操作 

在介绍 TCP 协议收发消息的操作之后，我们再来看看实际的网络包是如 何进行收发的。协议栈会与网卡进行配合，将数据切分成小块并封装成网络 包，再将网络包转换成电信号或者光信号发送出去。介绍完这个过程之后， 大家应该就可以对计算机网络功能有一个完整的概念了。 

### （6）用 UDP 协议收发数据的操作 

TCP 协议有很多方便的功能，比如网络包出错丢失时可以重发，因此 很多应用程序都是使用 TCP 协议来收发数据的，但这些方便的功能也有帮 倒忙的时候，在这种情况下我们还有另外一种叫 UDP 的协议。这里我们将 介绍 UDP 的必要性以及它与 TCP 的差异。